---
description: Revise as metodologias de pentest da Vantinco para Azure Active Directory.
---

# Metodologias Pentest Azure Active Directory

Azure Active Directory (AD) é uma solução de gerenciamento de identidade e acesso baseada em nuvem da Microsoft.

O teste de penetração do Azure AD é um processo no qual um testador utiliza ataques simulados para identificar potenciais vulnerabilidades de segurança no serviço.



**Introdução**

O Azure AD fornece uma solução para gerenciar a identidade e o acesso do usuário na nuvem e no local, em comparação com o Active Directory apenas com infraestrutura local. Saiba mais sobre o Azure AD e como ele se compara ao Active Directory.

Devido à sua prevalência, o Azure AD torna-se frequentemente alvo de ataques cibernéticos. aqui estão alguns exemplos:

* Por ser uma tecnologia híbrida, existem riscos de controle de acesso, como do local para a nuvem e da nuvem para o local.&#x20;
* Um ator de ameaça pode acessar o controlador do Active Directory local por meio de um sistema comprometido na nuvem ou acessar o Azure AD por meio dos sistemas Windows locais.&#x20;
* Um invasor pode explorar uma vulnerabilidade detectada em aplicativos Web no Azure. Em seguida, eles poderão obter acesso à nuvem ou à infraestrutura local do Azure AD.



**Detalhes da Metodologia**

O teste de penetração de um serviço Azure AD inclui as seguintes etapas:

* Reconhecimento&#x20;
* Acesso inicial&#x20;
* Enumeração&#x20;
* Movimento lateral&#x20;
* Persistência&#x20;
* Relatórios, triagem e re-tests



**Reconhecimento**

Com base no alvo de teste que você fornece, nossos pentesters podem obter os seguintes detalhes sobre seu serviço do Azure AD:

* Nome e ID do locatário&#x20;
* Subdomínios no Azure&#x20;
* Serviços do Azure usados pela organização&#x20;
* IDs de e-mail&#x20;
* Usuários válidos e inválidos&#x20;
* Blobs públicos do Azure



**Ferramentas:**

Nossos pentesters podem usar ferramentas de varredura como:

* AADInternals
* MicroBurst



**Acesso Inicial**

Nossos pentesters podem acessar o ambiente Azure AD usando diversas técnicas, como:

* Pulverização de senha ou ataque de força bruta
* Vulnerabilidades de aplicativos da web
* Ataque ilícito de concessão de consentimento
* Aplicativos de função

Vamos revisar algumas técnicas com mais detalhes.



**Pulverização de senha**

Nossos pentesters podem usar ferramentas como o MSOLSPray para realizar o seguinte:

* Validação do usuário
* Validação de inquilino
* Verificação de status de MFA
* Identificação de contas desativadas ou bloqueadas
* Verificação de expiração de senha



**Vulnerabilidades de aplicativos da Web**

​​Um aplicativo Web no Azure pode ser executado com a permissão do Azure Function Service ou do Azure App Service, como identidade gerenciada. Para aplicações executadas com direitos de identidade geridos, um atacante pode obter acesso não autorizado aos recursos do Azure se tiver um token de acesso do utilizador.

Nossos pentesters tentam:

* Identifique uma vulnerabilidade de execução de comando em seu aplicativo web. Eles executam um comando para determinar se seu aplicativo está sendo executado com direitos de identidade gerenciados.
* Obtenha um token de acesso com direitos de identidade geridos ligando para o ponto final do Azure Resource Manager (ARM).
* Execute a enumeração autenticada usando ferramentas como o Az PowerShell.
* Acesse os recursos do Azure após a autenticação no ambiente do Azure AD com identidade gerenciada.



**Enumeração**

Depois de obter acesso ao Azure AD pertencente à organização alvo, nossos pentesters realizam coleta e enumeração de informações. Eles podem usar ferramentas como:

* StormSpotter
* BloodHound
* ROADTools
* Authentication via CLI:
  * Az CLI
  * Az PowerShell



**Movimento Lateral**

Depois de obter acesso inicial ao Azure AD, os nossos pentesters tentam realizar ataques de movimento lateral. Isso inclui:

* Acessando diversos recursos no Azure AD com o token de acesso obtido nas etapas anteriores.
* Capturar as informações do token de acesso de um usuário autorizado.

Nossos pentesters podem usar várias etapas de controle para conseguir isso, como:

* Recursos e Runbook do Azure
* Atribuição de função
* Livro de execução
* História do PowerShell
* Conta de automação
* Modelos ARM
* Dados do usuário
* Extensão de script personalizada
* VMs do Azure (ingressadas híbridas)
* Token de atualização principal (PRT)

Vamos revisar algumas dessas etapas com mais detalhes.



**Recursos e Runbook do Azure**

Na fase de acesso inicial, nossos pentesters obtêm as informações do token de acesso de um usuário com direitos de identidade gerenciados na aplicação web.

* Os Pentesters autenticam-se no ambiente Azure AD utilizando a ferramenta Az PowerShell com os detalhes simbólicos que obtiveram.
* Em seguida, verificam quais recursos do Azure o usuário pode acessar. Isso permite que nossos pentesters identifiquem permissões que um invasor pode explorar.



**Histórico do PowerShell**

Se você é um administrador de sistema e opera no Azure AD usando o terminal do PowerShell, certifique-se de encerrar suas sessões com segurança. Os administradores do sistema realizam operações no Azure AD usando as seguintes ferramentas com uma sessão do PowerShell:

* Az PowerShell
* Az CLI

Nossos pentesters identificam se um invasor pode obter um token de acesso usando essas ferramentas.



**Persistência**\
Depois de obter uma conta de usuário autorizada com ataques de movimento lateral, nossos pentesters utilizam diferentes técnicas para acessar o Azure AD, como:

* AZUREADASSOC
* Federação – Domínio Confiável
* Chaves de acesso à conta de armazenamento
* Aplicativos e princípios de serviço

Por exemplo, é assim que funciona a técnica de Aplicativos e Princípios de Serviço. Para obter privilégios de utilizador com direitos de Administrador Global no Azure AD, os nossos pentesters primeiro criam uma aplicação com privilégios elevados. Em seguida, eles criam um aplicativo com privilégios de redefinição de senha no usuário Administrador Global.



**Relatórios, triagem e re-test**

Os pentesters Vantico relatam e fazem a triagem de todas as vulnerabilidades durante a avaliação. Você pode revisar os detalhes de todas as descobertas, em tempo real, por meio da plataforma Vantico. Nessas descobertas, assim como em qualquer relatório, nossos pentesters incluem informações detalhadas sobre como você pode:

* Corrigir cada descoberta&#x20;
* Melhorar sua postura geral de segurança

Você pode corrigir as descobertas durante e após o pentest. Em seguida, você pode enviar as descobertas para novo teste. Nossos pentesters testam os componentes atualizados e testam novamente os problemas para garantir que não haja riscos residuais relacionados à segurança.



**Recursos**&#x20;

* Blog do pentester Vantico Orhan Yildirim
