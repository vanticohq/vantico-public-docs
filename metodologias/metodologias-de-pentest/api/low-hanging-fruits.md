# Low Hanging Fruits

## Descoberta de serviços

Inicialmente, iremos mapear as APIs presentes na aplicação, para isso devemos navegar por toda a aplicação a fim de mapear endpoints e chamadas da API.

Em seguida com as rotas mapeadas podemos entender qual tipo de API se trata, como REST, GraphQL,  SOAP e com isto podemos avançar em nosso pentest.

{% hint style="success" %}
Para mais informações sobre o tipo de API utilizado pode ser consultado os links abaixo:

[GraphQL](../../api/graphql.md)

[REST](../../api/rest.md)
{% endhint %}

Com o mapeamento podemos iniciar o processo de fuzzing na API com o intuito de encontrar endpoints referentes a **documentação, sensíveis, sem autenticação.**

Para esta etapa podem ser utilizadas ferramentas como:\
[**ffuf**](https://github.com/ffuf/ffuf)**,** [**Dirb**](https://salsa.debian.org/pkg-security-team/dirb)**,** [**gobuster**](https://github.com/OJ/gobuster)**,** [**wfuzz**](https://github.com/xmendez/wfuzz)

Algumas wordlists conhecidas da **SecList** para pentest em API:

[api-endpoints](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/api/api-endpoints.txt), [actions](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/api/actions.txt), [objects](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/api/objects.txt)

***

> Uso de mesma chave de API em ambientes de produção e homologação

O uso da mesma chave de API em ambientes de produção e homologação é uma prática de segurança inadequada e pode levar a sérios riscos. Esse erro pode expor dados sensíveis, permitir acesso não autorizado e comprometer a integridade dos sistemas.

Se a chave de API usada em homologação for comprometida, o atacante pode obter acesso ao ambiente de produção, onde dados sensíveis estão armazenados.



***

> Força bruta na assinatura JWT

Caso a aplicação possua tokens JWT, o mesmo deve ser copiado e enviado para tentar quebrá-lo, a fim de obter o valor do _secret_ e assim poder forjar tokens.

Para quebrar podemos utilizar o _hashcat_, seguindo o formato a seguir.

_hashcat -a 0 -m 16500 token.txt wordlist.txt_



***

> JWT contendo informações PII

Deve ser decodificado o JWT e inspecionado ele, caso haja informações como nome, dados pessoais, e-mail ou qualquer outro dado PII, é validado a vulnerabilidade.



***

> Verificações no JWT

Verificar o que há dentro do token JWT, deve ser reportado caso o token apresente: Criptografia fraca ou dados pessoais e informações sensíveis.

Para verificar basta acessar:

[JWT](https://jwt.io/)

Ferramentas úteis para auxiliar:

[JWT Pentest Tool](https://github.com/ticofookfook/JWT_PENTEST/)

[JWTLens](https://jwtlens.netlify.app/)



***

> Ausência de cabeçalho

Toda vulnerabilidade que envolve a **ausência de cabeçalhos ("header")** deve ser adicionada **separadamente** para cada cabeçalho ausente presente no escopo.

Por padrão, APIs devem conter o cabeçalho, HTTP Strict Transport Security e Content-Security-Policy implementados.



***

> Uso de cabeçalho depreciado

Verificar se a aplicação apresenta cabeçalhos depreciados, como X-Frame-Options, X-XSS-Protection ou Feature-Policy.

Essa validação pode ser feita em conjunto com a identificação da ausência de cabeçalhos.



***

> Ausência de mecanismo contra força bruta

Essa vulnerabilidade deve ser testada em diferentes campos, como login, redefinição de senha e MFA.

Login: Deve ser testado se há algum controle anti automação ao inserir o mesmo e-mail porém com diversas senhas em um curto período de tempo.

Redefinição de senha: Verificar se possui algum mecanismo ao inserir diversos e-mails no campo.

MFA: Validar se pode ser realizado ataques de força bruta no campo de código do MFA a fim de descobrir a combinação certa para realizar o bypass do mecanismo.



***

> Enumeração de usuários

Ocorre geralmente na área de login, cadastro ou esqueci a senha, em que quando digitamos algum usuário e senha, a aplicação nos retorna que o usuário já existe, ou que o email não está cadastrado, fazendo com que o atacante consiga enumerar quais usuários/emails são válidos ou não.

Porém o mesmo pode ser encontrado em outras partes da aplicação, como por exemplo alguma aba de alterar o e-mail do usuário dentro da plataforma, pode haver de constar que o e-mail já está cadastrado.

A mensagem correta que a aplicação deve retornar é de **"Usuário ou Senha Incorretos"** ou **"Caso o email já estiver cadastrado você receberá um link na sua caixa de email"**



***

> Flood de email no campo de redefinição de senha

Para realizar o teste dessa vulnerabilidade, devemos: entrar na aba esqueci minha senha, depois inserir o e-mail e interceptar o request quando apertado o botão de enviar, assim com este request, jogamos no repeater e ficamos enviando a mesma requisição diversas vezes, caso todas foram aceitas, irá gerar um flood de e-mails na caixa de entrada do usuário.



***

> Ausência de WAF

Identificar se a aplicação possui algum mecanismo de WAF presente.



***

> Nuclei / Katana

Ambos são ferramentas utilizadas para fazer um scanning na API, porém o Nuclei busca por vulnerabilidades baseadas em templates, enquanto Katana é um crawler utilizado para conseguir mapear endpoints e subdomínios.

Utilização Nuclei:

```
nuclei -u (domínio) -headless -sc -fr -rl 50
```

Utilização Katana

```
katana -u (domínio) -jc -jsl
```



***

> Fuzzuli

Fuzzuli é uma ferramenta utilizada para buscar arquivos de backup presentes na aplicação.

Pode ser utilizada com o seguinte comando: _cat alvos.txt | fuzzuli -mt all_

Para mais informações, consulte [Fuzzuli](https://github.com/musana/fuzzuli).



***

> Acesso via IP diretamente

Ao identificar o endereço IP da aplicação, realize uma requisição com o endereço IP, caso a aplicação não faça o redirecionamento para o endereço DNS a mesma se encontra vulnerável a alguns ataques como bypass de WAF.



***

> Alterar tokens



***

## Automação

Algumas ferramentas podem ser utilizadas para apoio no processo do pentest, a fim de auxiliar o pentester a cobrir todo o teste na API.



### Nuclei

[Nuclei](https://github.com/projectdiscovery/nuclei) é uma ferramenta desenvolvida pela ProjectDiscovery que auxilia em scans na API e em aplicações web utilizando templates.

```
# Para uma lista de alvos
nuclei -l lista.txt

# Para um único alvo
nuclei -u alvo.com.br
```



### Burp Suite

O próprio [Burp Suite](https://portswigger.net/burp/communitydownload) pode ser utilizado para fazer scans automatizados na API, basta ir na aba "Targets" e clicar com o botão direito e ir até "Scan" e selecionar as configurações do scan.



### Swagger Jacker

[Swagger Jacker](https://github.com/BishopFox/sj) ferramenta é muito útil quando identificado um endpoint de Swagger, pois através dela podemos automatizar ataques de brute force, automação e visualizar rapidamente quais endpoints se encontram acessíveis sem autenticação.
